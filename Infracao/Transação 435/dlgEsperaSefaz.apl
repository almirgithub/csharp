Application Description: Centura SQLWindows Standard Application Template
	Outline Version - 4.0.28
	Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000D40000 002C000000020000 0003000000FFFFFF FFFFFFFFFFF8FFFF
0040: FFE2FFFFFFFFFFFF FF000000007C0200 004D010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
		Outline Window State: Normal
		Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
			Left: -0.013"
			Top: 0.0"
			Width:  8.013"
			Height: 4.969"
		Options Box Location
.data VIEWINFO
0000: D4180909B80B1A00
.enddata
.data VIEWSIZE
0000: 0800
.enddata
			Visible? Yes
			Left: 4.15"
			Top: 1.885"
			Width:  3.8"
			Height: 2.073"
		Class Editor Location
			Visible? No
			Left: 0.575"
			Top: 0.094"
			Width:  5.063"
			Height: 2.719"
		Tool Palette Location
			Visible? No
			Left: 6.388"
			Top: 0.729"
		Fully Qualified External References? Yes
		Reject Multiple Window Instances? No
		Enable Runtime Checks Of External References? Yes
		Use Release 4.0 Scope Rules? No
	Libraries
		File Include: detran_classes.apl
		File Include: detran_funcoes.apl
	Global Declarations
		Window Defaults
			Tool Bar
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Form Window
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Dialog Box
				Display Style? Etched
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Top Level Table Window
				Font Name: MS Sans Serif
				Font Size: 8
				Font Enhancement: System Default
				Text Color: System Default
				Background Color: System Default
			Data Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Multiline Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Spin Field
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Background Text
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Pushbutton
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Radio Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Check Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Option Button
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
			Group Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Child Table Window
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			List Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Combo Box
				Font Name: Use Parent
				Font Size: Use Parent
				Font Enhancement: Use Parent
				Text Color: Use Parent
				Background Color: Use Parent
			Line
				Line Color: Use Parent
			Frame
				Border Color: Use Parent
				Background Color: 3D Face Color
			Picture
				Border Color: Use Parent
				Background Color: Use Parent
		Formats
			Number: 0'%'
			Number: #0
			Number: ###000
			Number: ###000;'($'###000')'
			Date/Time: hh:mm:ss AMPM
			Date/Time: M/d/yy
			Date/Time: MM-dd-yy
			Date/Time: dd-MMM-yyyy
			Date/Time: MMM d, yyyy
			Date/Time: MMM d, yyyy hh:mm AMPM
			Date/Time: MMMM d, yyyy hh:mm AMPM
		External Functions
		Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
			System
			User
			Enumerations
		Resources
		Variables
.data RESOURCE 0 0 1 3923359385
0000: 2200000012000000 0000000000000000 02008001000000B2 0100D01900000001
0020: FE00FF03
.enddata
		Internal Functions
		Named Menus
		Class Definitions
.data RESOURCE 0 0 1 1443028049
0000: AC030000CA010000 0000000000000000 0200000500FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666FC2003C00 000A630051434B31
0040: 47657261006C0202 00001100001E0004 0000C20003000000 FF7F048300190000
0060: 00F001000000FF1F 1D0000AC00190001 FD00FF0736000000 196B000100FFFFC1
0080: 4F00000019DA0001 00FF7F68B0000000 0400F4020000FF1F 6C0000AC00040002
00A0: FD00FF0770000000 046B000200FFFFC1 7400000004DA0002 00FF7F78B0000000
00C0: 0400F60200FF1F7C 0000AC00040002FD 00FF17800000046B 000200FFFFC18400
00E0: 000004DA000200FF 7F88B00000000400 F60200FF1F8C0000 AC00190001FD00FF
0100: 07A5000000196B00 0100FFFFC1BE0000 0004DA000200FF7F 0180803E00000001
0120: 0070000E63514340 6F6E7461696E7220 AA0000000500006F 0400E801020000FF
0140: C18001000000BF04 190019000101FA00 007F80F20100000F 0800000096190001
0160: 00FE00FF83210000 0004B5000200FFFF 60250000001900ED 0100FF3F01806404
0180: 0000020038086351 4D44804922000000 0100DE0004DA0002 00FF7F01CC800400
01A0: 0370000D63514300 6865636B426F7822 A20000010000B704 00F60200FF1F0180
01C0: 0433000400060063 4461646F732200D1 000100005B040002 FB00FF0F
.enddata
		Default Classes
			MDI Window: cBaseMDI
			Form Window:
			Dialog Box:
			Table Window:
			Quest Window:
			Data Field:
			Spin Field:
			Multiline Field:
			Pushbutton:
			Radio Button:
			Option Button:
			Check Box:
			Child Table:
			Quest Child Window: cQuickDatabase
			List Box:
			Combo Box:
			Picture:
			Vertical Scroll Bar:
			Horizontal Scroll Bar:
			Column:
			Background Text:
			Group Box:
			Line:
			Frame:
			Custom Control:
			ActiveX:
		Application Actions
	Dialog Box: dlgEsperaSefaz
		Class:
		Property Template:
		Class DLL Name:
		Title:
		Accessories Enabled? No
		Visible? Yes
		Display Settings
			Display Style? Default
			Visible at Design time? No
			Type of Dialog: Modal
			Window Location and Size
				Left: 8.65"
				Top: 1.969"
				Width:  5.25"
				Width Editable? Yes
				Height: 1.438"
				Height Editable? Yes
			Absolute Screen Location? Yes
			Font Name: Default
			Font Size: Default
			Font Enhancement: Default
			Text Color: Default
			Background Color: Default
		Description:
		Tool Bar
			Display Settings
				Display Style? Default
				Location? Top
				Visible? Yes
				Size: Default
				Size Editable? Yes
				Font Name: Default
				Font Size: Default
				Font Enhancement: Default
				Text Color: Default
				Background Color: Default
			Contents
		Contents
			Picture: picDetran
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Window Location and Size
					Left: 0.088"
					Top: 0.073"
					Width:  1.1"
					Width Editable? Yes
					Height: 0.833"
					Height Editable? Yes
				Visible? Yes
				Editable? No
				File Name: Detran3.bmp
				Storage: External
				Picture Transparent Color: Gray
				Fit: Size to Fit
				Scaling
					Width:  0
					Height:  0
				Corners: Square
				Border Style: Solid
				Border Thickness: 1
				Tile To Parent? No
				Border Color: 3D Face Color
				Background Color: 3D Face Color
				Message Actions
			Background Text: REALIZANDO COMUNICAÇÃO COM
				Resource Id: 6338
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cQCK1BackgroundText
				Window Location and Size
					Left: 1.188"
					Top: 0.177"
					Width:  2.75"
					Width Editable? Class Default
					Height: 0.208"
					Height Editable? Class Default
				Visible? Class Default
				Justify: Center
				Font Name: Arial
				Font Size: 10
				Font Enhancement: Bold
				Text Color: Dark Aqua
				Background Color: Class Default
			Background Text: REALIZANDO A TRANSAÇÃO
				Resource Id: 6339
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cQCK1BackgroundText
				Window Location and Size
					Left: 1.188"
					Top: 0.885"
					Width:  2.75"
					Width Editable? Class Default
					Height: 0.208"
					Height Editable? Class Default
				Visible? Class Default
				Justify: Center
				Font Name: Arial
				Font Size: 10
				Font Enhancement: Bold
				Text Color: Dark Aqua
				Background Color: Class Default
			Background Text: AGUARDE RETORNO!!!
				Resource Id: 6340
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class: cQCK1BackgroundText
				Window Location and Size
					Left: 1.338"
					Top: 0.552"
					Width:  2.85"
					Width Editable? Class Default
					Height: 0.271"
					Height Editable? Class Default
				Visible? Class Default
				Justify: Center
				Font Name: Arial
				Font Size: 12
				Font Enhancement: Bold-Italic
				Text Color: Dark Aqua
				Background Color: Class Default
			Data Field: dfnRelogio
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: Number
					Editable? Yes
				Display Settings
					Window Location and Size
						Left: 4.388"
						Top: 0.594"
						Width:  0.65"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Border? No
					Justify: Center
					Format: Unformatted
					Country: Default
					Font Name: Arial
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Black
					Background Color: 3D Face Color
					Input Mask: Unformatted
				Message Actions
					On SAM_Create
						Call SalDisableWindow( hWndItem )
			Data Field: dfnTransacao
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 4
					Data Type: Number
					Editable? Yes
				Display Settings
					Window Location and Size
						Left: 3.988"
						Top: 0.885"
						Width:  0.65"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Border? No
					Justify: Center
					Format: Unformatted
					Country: Default
					Font Name: Arial
					Font Size: 10
					Font Enhancement: Bold
					Text Color: Black
					Background Color: 3D Face Color
					Input Mask: Unformatted
				Message Actions
					On SAM_Create
						Call SalDisableWindow( hWndItem )
			Data Field: dfsDestino
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: Default
					Data Type: String
					Editable? No
				Display Settings
					Window Location and Size
						Left: 3.988"
						Top: 0.177"
						Width:  0.85"
						Width Editable? Yes
						Height: 0.25"
						Height Editable? Yes
					Visible? Yes
					Border? No
					Justify: Left
					Format: Unformatted
					Country: Default
					Font Name: Default
					Font Size: 10
					Font Enhancement: Default
					Text Color: Teal
					Background Color: 3D Face Color
					Input Mask: Unformatted
				Message Actions
					On SAM_Create
						Call SalDisableWindow( hWndItem )
			Multiline Field: mlSefazNfe
				Class Child Ref Key: 0
				Class ChildKey: 0
				Class:
				Property Template:
				Class DLL Name:
				Data
					Maximum Data Length: 10000
					String Type: Long String
					Editable? Yes
				Display Settings
					Border? Yes
					Word Wrap? No
					Vertical Scroll? Yes
					Window Location and Size
						Left: Default
						Top: Default
						Width:  Default
						Width Editable? Yes
						Height: Default
						Height Editable? Yes
					Visible? No
					Font Name: Default
					Font Size: Default
					Font Enhancement: Default
					Text Color: Default
					Background Color: Default
				Message Actions
		Functions
		Window Parameters
			Long String: sTringEnvio
			Number: nTipoTransacao
		Window Variables
			String: sTipoTransacao
			String: sIPSEFAZ
			Number: nPortaSEFAZ
			String: sVersaoNfe
			String: sIndCompNfe
			String: sAmbienteNfe
			String: sDestinoTransacao
			! Long String: sTringRetorno
			Sql Handle: hSqlComunicacao
			Number: nFetch
			Number: nRetorno
			Long String: sTransacaoEnvio
			Long String: sTransacaoRetorno
			String: sChaveNfe
			Long String: sParametro
			Number: nNumseq
			Number: nCodTransacao
			Long String: ComandoSql
		Message Actions
			On SAM_Create
				Call SalWaitCursor( TRUE )
				Call SalCenterWindow( hWndForm )
				Call SalTimerSet( hWndForm, 1, 1000 )
			On SAM_CreateComplete
				Set dfnRelogio = 1
				Set nRetorno = 20
				! Verifica o tipo de transação
				If fMPSConnect( hSqlComunicacao )
					If fMPSPrepareProc( hSqlComunicacao, 'exec dbvcen..ParametroGeralSefazS', ':sIPSEFAZ, :nPortaSEFAZ, :sVersaoNfe, :sIndCompNfe, :sAmbienteNfe' )
						If SqlExecute( hSqlComunicacao )
							Call SqlFetchNext( hSqlComunicacao, nFetch )
							If nFetch = FETCH_Ok
								Call SalSetWindowText( hWndForm, 'Comunicação SEFAZ' )
								Set dfsDestino = 'SEFAZ !!!'
								If nTipoTransacao=1
									Set sChaveNfe = sTringEnvio
									Set sTringEnvio = SalNumberToStrX(nTipoTransacao, 0) || sVersaoNfe || sAmbienteNfe || SalStrTrimX(sChaveNfe) || sIndCompNfe
								Else
									Set sChaveNfe = SalStrMidX( sTringEnvio, 1, 44)
									Set sTringEnvio = SalNumberToStrX(nTipoTransacao, 0) || sVersaoNfe || sAmbienteNfe || SalStrTrimX(sTringEnvio)
								Call SalStrSetBufferLength( sTringEnvio, 6000 )
								Set sTransacaoEnvio = sTringEnvio
								! Call SalStrSetBufferLength( sTransacaoEnvio, 10000 )
								Set nRetorno = _FSocket32( sIPSEFAZ, nPortaSEFAZ, 20, sTringEnvio ,6000)
								Set sTransacaoRetorno = sTringEnvio
								Call SalStrSetBufferLength( sTransacaoRetorno, 6000 )
								Set dlgEsperaSefaz.mlSefazNfe = sTransacaoRetorno
								Call SalStrSetBufferLength( ComandoSql, 100000 )
								If SalStrLength(mlSefazNfe) < 6000
									Set mlSefazNfe = mlSefazNfe || SalStrRepeatX( " ", 6000-SalStrLength(mlSefazNfe) )
								Set ComandoSql =  'exec dbvcen..TransacaoEnvioNfeI
										@ChaveNfe = :sChaveNfe, @TipoTransacao = :nTipoTransacao, @StringEnvio = :sTransacaoEnvio, @StringRetorno="'||mlSefazNfe||'"'   
								If nRetorno > 0
									If fMPSPrepareProc( hSqlComunicacao, ComandoSql, '' )
										Call SqlExecute( hSqlComunicacao )
										Set nRetorno = 0
					Call fMPSDisconnect( hSqlComunicacao )
				! Fechando a janela
				Call SalWaitCursor( FALSE )
				Call SalEndDialog( dlgEsperaSefaz, nRetorno )
			On SAM_Timer
				Set dfnRelogio = dfnRelogio + 1
				If dfnRelogio = 20
					Call SalSendMsg(dlgEsperaSefaz,SAM_Destroy,wParam,lParam)
					Return TRUE
			On SAM_Destroy
				Call SalDestroyWindow ( dlgEsperaSefaz )
